# This file is configured at cmake time, and loaded at cpack time.
# To pass variables to cpack from cmake, they must be configured
# in this file.  

if(CPACK_GENERATOR MATCHES "NSIS")
	SET(CPACK_PACKAGE_INSTALL_DIRECTORY "@APPLICATION_VENDOR_PACKAGE@\\@APPLICATION_PACKAGE_NAME@")
	SET(CPACK_NSIS_INSTALLED_ICON_NAME "@APPLICATION_PACKAGE_NAME@.exe")
	SET(CPACK_NSIS_DISPLAY_NAME "@APPLICATION_NAME@")
	SET(CPACK_NSIS_HELP_LINK "http://@APPLICATION_VENDOR_DOMAIN@")
	SET(CPACK_NSIS_URL_INFO_ABOUT "http://@APPLICATION_VENDOR_DOMAIN@")
	SET(CPACK_NSIS_CONTACT "@APPLICATION_CONTACTMAIL@")
	SET(CPACK_NSIS_EXECUTABLES_DIRECTORY ".")
	SET(CPACK_NSIS_MUI_FINISHPAGE_RUN "@APPLICATION_PACKAGE_NAME@.exe")
	SET(CPACK_NSIS_ENABLE_UNINSTALL_BEFORE_INSTALL ON)
	
	SET(CPACK_NSIS_EXTRA_INSTALL_COMMANDS "")
	
	# Add desktop icon CPACK_CREATE_DESKTOP_LINKS won't work without CPACK_NSIS_MODIFY_PATH
	SET(CPACK_NSIS_EXTRA_INSTALL_COMMANDS "
		${CPACK_NSIS_EXTRA_INSTALL_COMMANDS}
		CreateShortCut '\$DESKTOP\\\\@APPLICATION_NAME@.lnk' '\$INSTDIR\\\\@APPLICATION_PACKAGE_NAME@.exe'
		ExecWait 'msiexec /i \"\$INSTDIR\\\\3rdparty\\\\Bonjour64.msi\" /qn' $R0
		\${If} $R0 = 1633
			ExecWait 'msiexec /i \"\$INSTDIR\\\\3rdparty\\\\Bonjour.msi\" /qn' $R0
			\${If} $R0 != 0
				MessageBox MB_OK \"Failed to install Bonjour service!\"
			\${EndIf}
		\${EndIf}
	")

	SET(CPACK_NSIS_EXTRA_UNINSTALL_COMMANDS "
		Delete '\$SMSTARTUP\\\\@APPLICATION_NAME@.lnk'
		Delete '\$DESKTOP\\\\@APPLICATION_NAME@.lnk'
	")

endif(CPACK_GENERATOR MATCHES "NSIS")

